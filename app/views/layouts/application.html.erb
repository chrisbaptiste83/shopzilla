<!DOCTYPE html>
<html>
<head>
  <title>Embroidery Shop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags if defined?(javascript_importmap_tags) %>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
  <script src="https://js.stripe.com/v3/"></script>
  <%= javascript_importmap_tags %>
</head>
<body class="bg-base-200">
  <!-- Navigation Bar -->
  <div class="navbar bg-base-100 shadow-xl sticky top-0 z-50">
    <div class="navbar-start">
      <div class="dropdown">
        <label tabindex="0" class="btn btn-ghost lg:hidden">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" />
          </svg>
        </label>
        <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
          <li><%= link_to "Products", products_path %></li>
          <li>
            <details>
              <summary>Categories</summary>
              <ul class="p-2">
                <% Category.all.each do |category| %>
                  <li><%= link_to category.name, category_path(category) %></li>
                <% end %>
              </ul>
            </details>
          </li>
          <li><%= link_to "About", about_path %></li>
          <li><%= link_to "Contact", contact_path %></li>
        </ul>
      </div>
      <%= link_to root_path, class: "btn btn-ghost normal-case text-xl font-bold" do %>
        <span class="text-primary">‚úÇÔ∏è</span> Embroidery Shop
      <% end %>
    </div>

    <div class="navbar-center hidden lg:flex">
      <ul class="menu menu-horizontal px-1 gap-2">
        <li><%= link_to "Products", products_path, class: "font-medium" %></li>
        <li>
          <details>
            <summary class="font-medium">Categories</summary>
            <ul class="p-2 bg-base-100 rounded-t-none">
              <% Category.all.each do |category| %>
                <li><%= link_to category.name, category_path(category), class: "block px-2 py-1" %></li>
              <% end %>
            </ul>
          </details>
        </li>
        <li><%= link_to "About", about_path, class: "font-medium" %></li>
        <li><%= link_to "Contact", contact_path, class: "font-medium" %></li>
      </ul>
    </div>

    <div class="navbar-end gap-2">
      <!-- Search -->
   
<div class="form-control hidden md:block">
  <%= form_with url: products_path, method: :get, local: true do |f| %>
    <%= f.text_field :search, placeholder: "Search designs...", class: "input input-bordered input-sm w-24 md:w-auto", value: params[:search], autocomplete: "off" %>
  <% end %>
</div>


      <!-- Wishlist -->
      <% if user_signed_in? %>
        <% wishlist_count = current_user.wishlist_items.count %>
        <%= link_to wishlist_items_path, class: "btn btn-ghost btn-circle" do %>
          <div class="indicator">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
            <% if wishlist_count.positive? %>
              <span class="badge badge-sm badge-secondary indicator-item"><%= wishlist_count %></span>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <!-- Shopping Cart -->
      <% if user_signed_in? %>
        <% cart = session[:cart] || {} %>
        <% cart_count = cart.values.sum %>
        <% subtotal = Product.where(id: cart.keys).sum { |p| p.price * cart[p.id.to_s].to_i } %>

        <div class="dropdown dropdown-end">
          <label tabindex="0" class="btn btn-ghost btn-circle text-2xl">
            <div class="indicator">
              üõí
              <% if cart_count.positive? %>
                <span class="badge badge-sm badge-primary indicator-item"><%= cart_count %></span>
              <% end %>
            </div>
          </label>

          <div tabindex="0" class="mt-3 z-[1] card card-compact dropdown-content w-52 bg-base-100 shadow">
            <div class="card-body">
              <span class="font-bold text-lg"><%= cart_count %> Items</span>
              <span class="text-info">Subtotal: $<%= subtotal %></span>
              <div class="card-actions">
                <%= link_to "View Cart", cart_path, class: "btn btn-primary btn-block" %>
                <%= link_to "Clear Cart", clear_cart_path, method: :delete, class: "btn btn-error btn-block btn-sm mt-1" if cart_count.positive? %>
              </div>
            </div>
          </div>
        </div>
      <% else %>
        <%= link_to new_user_session_path, class: "btn btn-ghost btn-circle text-2xl" do %>
          <div class="indicator">
            üõí
          </div>
        <% end %>
      <% end %>

      <!-- User Menu -->
      <% if user_signed_in? %>
        <% if current_user.admin? %>
          <%= link_to "Add Product", new_product_path, class: "btn btn-ghost btn-sm text-primary hidden lg:inline-flex" %>
          <%= link_to "Admin", admin_root_path, class: "btn btn-ghost btn-sm text-primary hidden lg:inline-flex" if defined?(admin_root_path) %>
        <% end %>
        <div class="dropdown dropdown-end">
          <label tabindex="0" class="btn btn-ghost btn-circle avatar">
            <div class="w-10 rounded-full">
              <% if current_user.avatar.attached? %>
                <%= image_tag current_user.avatar.variant(resize_to_fill: [40, 40]), class: "rounded-full" %>
              <% else %>
                <img src="https://ui-avatars.com/api/?name=<%= current_user.email.first %>&background=random" alt="User Avatar" />
              <% end %>
            </div>
          </label>
          <ul tabindex="0" class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
            <li class="menu-title">
              <span><%= current_user.email %></span>
            </li>
            <li><%= link_to "Profile", profile_path %></li>
            <li><%= link_to "Orders", "#" %></li>
            <li><%= link_to "Wishlist", wishlist_items_path %></li>
            <li>
              <%= form_with url: destroy_user_session_path, method: :delete, local: true do %>
                <%= submit_tag "Logout", class: "btn btn-ghost text-error w-full text-left" %>
              <% end %>
            </li>
          </ul>
        </div>
      <% else %>
        <%= link_to "Login", new_user_session_path, class: "btn btn-ghost btn-sm" %>
        <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-primary btn-sm" %>
      <% end %>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto p-4">
    <% if notice %>
      <div class="alert alert-success shadow-lg mb-4">
        <span><%= notice %></span>
      </div>
    <% end %>
    <% if alert %>
      <div class="alert alert-error shadow-lg mb-4">
        <span><%= alert %></span>
      </div>
    <% end %>
    <%= yield %>
  </div>

  <!-- Footer -->
  <footer class="footer p-10 bg-base-200 text-base-content mt-16">
    <div>
      <span class="footer-title">Shop</span>
      <a class="link link-hover" href="<%= products_path %>">All Products</a>
      <% Category.all.each do |category| %>
        <a class="link link-hover" href="<%= category_path(category) %>"><%= category.name %></a>
      <% end %>
    </div>
    <div>
      <span class="footer-title">Support</span>
      <a class="link link-hover" href="<%= contact_path %>">Contact Us</a>
      <a class="link link-hover">Help Center</a>
      <a class="link link-hover">Size Guide</a>
      <a class="link link-hover">File Formats</a>
      <a class="link link-hover">Machine Compatibility</a>
    </div>
    <div>
      <span class="footer-title">Company</span>
      <a class="link link-hover" href="<%= about_path %>">About Us</a>
      <a class="link link-hover">Blog</a>
      <a class="link link-hover">Careers</a>
      <a class="link link-hover">Press</a>
    </div>
    <div>
      <span class="footer-title">Legal</span>
      <a class="link link-hover">Terms of Service</a>
      <a class="link link-hover">Privacy Policy</a>
      <a class="link link-hover">Cookie Policy</a>
      <a class="link link-hover">Refund Policy</a>
    </div>
  </footer>
  
  <footer class="footer px-10 py-4 border-t bg-base-200 text-base-content border-base-300">
    <div class="items-center grid-flow-col">
      <div class="flex items-center gap-2">
        <span class="text-primary text-2xl">‚úÇÔ∏è</span>
        <p class="font-semibold">Embroidery Shop</p>
      </div>
      <p>&copy; <%= Time.current.year %> All rights reserved.</p>
    </div>
    <div class="md:place-self-center md:justify-self-end">
      <div class="grid grid-flow-col gap-4">
        <a class="link link-hover">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current">
            <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path>
          </svg>
        </a>
        <a class="link link-hover">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current">
            <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path>
          </svg>
        </a>
        <a class="link link-hover">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current">
            <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path>
          </svg>
        </a>
      </div>
    </div>
  </footer>
</body>
</html>

